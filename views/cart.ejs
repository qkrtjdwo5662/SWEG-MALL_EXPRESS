<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SWEG MALL</title>
   <!-- css 초기화 -->
  <link
   rel="stylesheet"
   href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css"
   />
   <link rel="stylesheet" href="/css/style.css" />
   <link rel="stylesheet" href="/css/cart.css" />
  <!-- 구글폰트 -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap"
    rel="stylesheet"
  />
  <!-- 구글 아이콘 -->
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
  />
</head>
<body>
  <div class="wrap">
    <div class="top">
      <%-include('./include/nav.ejs')%>
    </div>
    <hr class="line">
    <div class="contents_area_wrap">
      <div class="container_full page_title_area">
        <div class="container_fixed page_title_wrap">
            쇼핑백
        </div>
      </div>
      <div class="container_full cart_table_area">
        <div class="container_fixed">
            <div class="title_area">
              <div class="area_title">
                    배송상품
              </div>
              <div class="line"></div>
              <div class="title_contents">
                    총 <span><%=cart.length%></span>개의 상품이 있습니다.
              </div>
            </div>

            <div class="info_area" style="color:#666666; margin-top:5px; font-weight:300;">
                배송비는 최종 주문서에서 확인 가능하며, 결제 금액 확인부탁드립니다.
            </div>

            <div class="cart_table">
              <div class="header">
                    <div class="check_box_area">
                        <div class="check_box">
                            <input id="cartAll1" class="form_check cart_select cart1_seq" type="checkbox"> 
                            <!-- <label for="cartAll1" class="">배송상품 전체 선택</label> -->
                        </div>
                    </div>
                    <div class="info_wrap">
                        <div class="info_set">
                            <div class="pro_info_area">
                                상품정보
                            </div>
                            <div class="quantity_area">
                                수량 옵션
                            </div>
                            <div class="price_area">
                                상품금액
                            </div>
                            <div class="delivery_fee_area">
                                배송비
                            </div>
                        </div>
                    </div>
                    <div class="func_area">
                        선택
                    </div>
                </div>
                <div class="table_body">

                  <!-- 여기가 이제 그 장바구니 담은 만큼 -->
                  <%if(cart.length>0){%>
                    <% for(let i=0; i<cart.length; i++) {%>
                    <div class="item_wrap">
                        <div class="item">
                          <div class="check_box_area">
                              <div class="check_box">
                                  <input type="checkbox" data-model="<%=cart[i].model%>" name="cart1_seq" class="form_check cart_select cart_item" value="79551">
                              </div>
                          </div>
    
                          <div class="info_wrap"> 
                              <div class="info_set">
                                  <div class="pro_info_area">
                                      <div class="cart_pro_info">
                                          <a href="/products/detail/<%=cart[i].model%>">
                                              <div class="image_area">
                                                <img src="<%=cart[i].img%>" onerror="this.src='/img/contents1-1.png';" alt="">
                                                  <div class="state_set">
                                                  </div>
                                              </div>
                                          </a>
                                          <div class="contents_area">
                                              <div class="pro_name">
                                                  <a href="/products/detail/<%=cart[i].model%>">
                                                    <%=cart[i].name%>                                                
                                                </a>
                                              </div>
                                              <div class="model_name">
                                                <%=cart[i].model%>                                           
                                              </div>
                                              <div class="pro_price">
                                                <%=cart[i].price%>                                           
                                                </div>
                                          </div>
                                      </div>
                                  </div>
                                  <div class="quantity_area">
                                      <div class="con_info quantity_ui">
                                          <a href="javascript:;" class="count_btn count_minus_main">
                                              <img src="/img/common/icon_count_minus.svg" alt="">
                                          </a>
                                          <div class="count_num count_num_main" data-pro_seq="3001" data-cseq="79551" data-cpseq="" data-cgroup="" data-stock="5" data-stock_safe="1" data-stock_num="4" data-cart_price_selling="2100000.00" data-order_max="0" data-order_min="1" data-order_num="1" data-reser_status="n" data-sale_status="sale">
                                              1                                       
                                          </div>
                                          <a href="javascript:;" class="count_btn count_plus_main">
                                              <img src="/img/common/icon_count_plus.svg" alt="">
                                          </a>
                                      </div>
                                  </div>
                                  <div class="price_area">
                                      
                                      <div class="price_inner_area">
                                          
                                          <div class="price price_main">
                                              <%=cart[i].price%>                                        
                                          </div>
                                      </div>
                                  </div>
                                  <div class="delivery_fee_area">
                                      <div class="fee">
                                          <div>무료</div>                                    
                                      </div>
                                  </div>
                              </div>
                          </div>
    
                          <div class="func_area">
                              <div class="btn_set">
                                <a href="/order/order/<%=cart[i].model%>" class="btn_basic positive" >바로구매</a>
                                <a href="javascript:;" class="btn_basic negative">삭제</a>
                              </div>
                          </div>
                        </div>
                      </div>
                      <%}%>
                  <%}%>
                  
                  <!-- 여기가 이제 그 장바구니 담은 만큼 -->

                </div>
            </div>
          </div>
      </div>
      <div class="container_full cart_check_area">
        <div class="container_fixed">
            <div class="item_wrap">
                <div class="check_box" style="display:none;">
                    <input id="cartAll0" name="cartAll0" class="form_check cart_all" type="checkbox"> 
                    <label for="cartAll0" class="">전체선택</label>
                </div>
                <div class="btn_set">
                    <a href="javascript:;" class="btn_basic negative" onclick="cart_del();">선택상품 삭제</a>
                </div>
            </div>
        </div>
      </div>
      <div class="container_full btn_area">
        <div class="container_fixed btn_wrap">
            <div class="btn_set">
                <a href="javascript:;" class="btn_basic positive orderBtn"><span id="order_cnt">0</span>건 주문하기</a>
            </div>
        </div>
      </div>

    </div>
  </div>
</body>

<script defer>
    // const count_minus_btn = document.querySelector('.count_minus_main');
    // const count_plus_btn = document.querySelector('.count_plus_main');
    // const count_num = document.querySelector('.count_num');
    // const total_cost = document.querySelector('.total_cost');
    // let total = 1;
    // count_minus_btn.addEventListener("click", (e) => {
    //   if(total !== 1){
    //     total = total - 1;
    //     count_num.textContent = total;
    //   }
    // })
    // count_plus_btn.addEventListener("click", (e) => {
    //   total = total +1;
    //   count_num.textContent = total;
    // })
  
    // 버튼에 대한 기능도 장바구니 개수 만큼 class 명 혹은 id명을 다르게해서 독립적으로 기능될 수 있도록 수정필요


    // const cartAllCheckBox = document.querySelector('#cartAll1');
    // // console.log(cartAllCheckBox);
    // cartAllCheckBox.addEventListener("change", (e) => {
    //     const inputChecked = cartAllCheckBox.checked;
    //     console.log(inputChecked);
    //     const cartItemCheckBox = document.querySelectorAll('.form_check');
    //     console.log(cartItemCheckBox);
    // })

  const cartCheckBoxAll = document.querySelector("#cartAll1")
  const cartItemCheckBox = document.querySelectorAll(".cart_table .item .cart_select")
  const orderLength = document.querySelector("#order_cnt")
  const orderBtn = document.querySelector(".orderBtn")
  
  //전체 체크박스
  function checkedAll(){
    cartItemCheckBox.forEach((checkBox)=>{
      checkBox.checked = cartCheckBoxAll.checked
    })
    updateOrderLength()
  }
  //체크박스 선택 시 카운트
  function updateOrderLength() {
    let checkedCount = 0;

    cartItemCheckBox.forEach(checkBox => {
        if (checkBox.checked) {
            checkedCount++;
        }
    });
    orderLength.innerText = checkedCount;
  } 

  
  cartCheckBoxAll.addEventListener("change",checkedAll)
  cartItemCheckBox.forEach((checkBox) => {
      checkBox.addEventListener("change", updateOrderLength);
  });

  //구매하기 버튼
  orderBtn.addEventListener("click", () => {
    let queryArr = [];
    productChecked  = 0;

    cartItemCheckBox.forEach((checkBox, index) => {
      if(checkBox.checked){
        productChecked++;
        
        const productModel = checkBox.dataset.model;
        let item = "";
        if (queryArr.length === 0) {
          item = "?product";
        } else {
          item = "&product";
        }
        queryArr.push(`${item}${index}=${productModel}`);
      }
    })

    const query = queryArr.join("")
    console.log(query)
    location.href = "/order/order" + query;

    if (productChecked === 0) {
      return alert("결제하실 상품을 선택해주세요.");
    }
  });  
  </script>
