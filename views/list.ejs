<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- css 초기화 -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <!-- 구글폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <!-- 구글 아이콘 -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />

    <title>SWEG MALL</title>
    <!-- <script defer src="/js/list.js"></script> -->
    <style>
      .nav-wrap .logo a {
        color: #fff;
      }
      .nav-wrap ul > li > a {
        color: #fff;
      }
      .nav-wrap .nav-item {
        color: #fff !important;
      }
    </style>
  </head>
  <body style="background-color: #f8f8f8">
    <div class="top-banner"><%-include('./include/nav.ejs')%></div>
    <div class="breadcrumbs" style="bottom: 0px">
      <div class="container">
        <div class="bar_area">
          <div class="location">
            <!-- <div class="loc_item">
                  <a href="/product/product_list.php?cate=13">
                      대형/빌트인                </a>
              </div> -->

            <div class="loc_item">
              <div class="form_row_content breadcrumb_select">
                <select id="1depth_cate" name="1depth_cate" class="form_text">
                  <option value="PRD001" data-cate_seq="13">PRODUCT</option>
                </select>
              </div>
            </div>

            <div class="loc_item">
              <div class="form_row_content breadcrumb_select">
                <select id="2depth_cate" name="2depth_cate" class="form_text">
                  <!-- <option value="" data-cate_seq="13">전체</option> -->
                  <option value="PRD001001" data-cate_seq="15">냉장고</option>
                  <option value="PRD001008" data-cate_seq="629">
                    토스터기
                  </option>
                  <option value="PRD001003" data-cate_seq="24">믹서기</option>
                  <option value="PRD001002" data-cate_seq="16">반죽기</option>
                  <option value="PRD001006" data-cate_seq="31">전자동커피머신</option>
                </select>
              </div>
            </div>
          </div>

          <div class="blank_areaw"></div>
          <div class="compare_area">
            <a href="javascript:;">
              <img src="/img/list/icon_bar_compare.svg" alt="" />
              <div class="compare_text">
                <span class="text_info">비교하기</span>
                <span id="compare_count" class="compare_count">0</span>
                <span class="compare_unit">개</span>
              </div>
              <img class="compare_down" src="" alt="" />
              <img class="compare_up" src="" alt="" />
              <div class="circle">
                <div
                  id="circle_item"
                  class="circle_item"
                  style="width: 5px; height: 5px; opacity: 0"
                ></div>
              </div>
            </a>
          </div>
        </div>
        <div class="compare_item_area">
          <!-- <div class="compare_title">상품 비교하기</div> -->
          <div class="item_wrap">
            <div id="compare_list" class="item_set">
              <div class="item_box no_item">선택된 상품이 없습니다.</div>
              <div class="item_box no_item">선택된 상품이 없습니다.</div>
              <div class="item_box no_item">선택된 상품이 없습니다.</div>
            </div>
            <div class="compare_func_area">
              <div class="compare_func">
                <a class="compare_btn"> 비교하기 </a>
                <a
                  href="#"
                  class="compare_init"
                  onclick="ajax_compare('init','');"
                >
                  <span>초기화</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-title">
      <div class="container">
        <h3 class="list-title">냉장고</h3>
      </div>
    </div>
    <div class="filter_bar">
      <div class="container">
        <div href="#" class="filter_btn">
          <div class="title">제품필터</div>
        </div>
      </div>
    </div>
    <div class="product_filter">
      <div class="container">
        <div class="filter_contents">
          <div class="inner">
            <div class="item style">
              <div class="title">사이즈</div>
              <div class="contents">
                <div class="unit">단위 (mm)</div>
                <div class="graph_area">
                  <div class="step">
                    <div class="step_num">2,000</div>
                    <div class="step_num">1,500</div>
                    <div class="step_num">1,000</div>
                    <div class="step_num">500</div>
                    <div class="step_num">0</div>
                  </div>
                  <div class="graph">
                    <a href="#" class="graph_link" data-name="FAB5">
                      <div class="graph_img">
                        <img src="/img/list/img_filter_fab5.svg" alt="fab5" />
                      </div>
                      <div class="graph_title">FAB5</div>
                    </a>
                    <a href="#" class="graph_link" data-name="FAB10">
                      <div class="graph_img">
                        <img src="/img/list/img_filter_fab10.svg" alt="fab10" />
                      </div>
                      <div class="graph_title">FAB10</div>
                    </a>
                    <a href="#" class="graph_link" data-name="FAB28">
                      <div class="graph_img">
                        <img src="/img/list/img_filter_fab28.svg" alt="fab28" />
                      </div>
                      <div class="graph_title">FAB28</div>
                    </a>
                    <a href="#" class="graph_link" data-name="FAB30">
                      <div class="graph_img">
                        <img src="/img/list/img_filter_fab30.svg" alt="fab30" />
                      </div>
                      <div class="graph_title">FAB30</div>
                    </a>
                    <a href="#" class="graph_link" data-name="FAB32">
                      <div class="graph_img">
                        <img src="/img/list/img_filter_fab32.svg" alt="fab32" />
                      </div>
                      <div class="graph_title">FAB32</div>
                    </a>
                    <a href="#" class="graph_link" data-name="FAB50">
                      <div class="graph_img">
                        <img src="/img/list/img_filter_fab50.svg" alt="fab50" />
                      </div>
                      <div class="graph_title">FAB50</div>
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <div class="item color">
              <div class="title">컬러</div>
              <div class="contents">
                <a
                  class="color_chip_icon"
                  data-colorname="화이트"
                  style="
                    background-image: url('/img/list/2022012611145442246.png');
                  "
                  alt="화이트"
                  title="화이트"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="크림"
                  style="
                    background-image: url('/img/list/2022012611143572434.png');
                  "
                  alt="크림"
                  title="크림"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="파스텔그린"
                  style="
                    background-image: url('/img/list/2022012611142371156.png');
                  "
                  alt="파스텔그린"
                  title="파스텔그린"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="파스텔블루"
                  style="
                    background-image: url('/img/list/2022012615591338515.png');
                  "
                  alt="파스텔블루"
                  title="파스텔블루"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="핑크"
                  style="
                    background-image: url('/img/list/2022012611135839577.png');
                  "
                  alt="핑크"
                  title="핑크"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="옐로우"
                  style="
                    background-image: url('/img/list/2022012615583792174.png');
                  "
                  alt="옐로우"
                  title="옐로우"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="라임그린"
                  style="
                    background-image: url('/img/list/2022012611132474427.png');
                  "
                  alt="라임그린"
                  title="라임그린"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="오렌지"
                  style="
                    background-image: url('/img/list/2022012611121487441.png');
                  "
                  alt="오렌지"
                  title="오렌지"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="레드"
                  style="
                    background-image: url('/img/list/2022012611134772601.png');
                  "
                  alt="레드"
                  title="레드"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="블루"
                  style="
                    background-image: url('/img/list/2022012611122889571.png');
                  "
                  alt="블루"
                  title="블루"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="실버"
                  style="
                    background-image: url('/img/list/2022012611141170613.png');
                  "
                  alt="실버"
                  title="실버"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="블랙"
                  style="
                    background-image: url('/img/list/2022012611133617369.png');
                  "
                  alt="블랙"
                  title="블랙"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="유니언잭"
                  style="
                    background-image: url('/img/list/2022012611123986092.png');
                  "
                  alt="유니언잭"
                  title="유니언잭"
                ></a>
                <a
                  class="color_chip_icon"
                  data-colorname="토프"
                  style="
                    background-image: url('/img/list/color_chip_special.png');
                  "
                  alt="토프"
                  title="스페셜"
                ></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="product_list-wrap">
      <div class="container">
        <div class="item_wrap">
          <div class="product_item_list">
            <%products.map(function (product) {%>
            <div
              class="item product_item"
              data-color="<%=product.color%>"
              data-name="<%=product.name%>"
            >
              <div class="image_area">
                <a href="/products/detail/<%=product.model%>">
                  <img src="<%=product.img%>" alt="" />
                </a>
                <div class="icon_compare">
                  <div
                    class="icon_text"
                    style="width: 50px"
                    data-name="<%= product.name %>"
                    data-model="<%= product.model %>"
                    data-color="<%=product.color%>"
                    data-price="<%= product.price %>"
                    data-img="<%= product.img %>"
                  >
                    비교하기
                  </div>
                </div>
              </div>
              <div class="info_area">
                <a href="#">
                  <div class="pro_name">
                    <%=product.name%> <%=product.color%>
                  </div>

                  <div class="model_name"><%=product.model%></div>
                </a>
                <div class="price_area">
                  <div class="price_set">
                    <div class="price_base"><%=product.price%></div>
                    <div class="price_sale">2,680,000</div>
                  </div>
                  <%if(product.count == 0){%>
                    <div class="state_set">                              
                      <div class="badge">품절</div>                        
                    </div>
                 
                  <% } %>
                </div>
              </div>
            </div>
            <%})%>
          </div>
          <div class="btn_set">
            <a
              href="javascript:;"
              class="btn_basic positive list_more_btn"
              onclick=""
              >+ MORE</a
            >
          </div>
        </div>
      </div>
    </div>
    <%-include('./include/footer.ejs')%>
  </body>
</html>

<script defer>
  const comparisonBtn = document.querySelector(".compare_area");
  const bottomBox = document.querySelector(".compare_item_area");
  const productList = document.querySelector(".product_item_list");

  //비교하기 드롭 토글버튼
  function comparison() {
    if (comparisonBtn) {
      // 비교하기를 클릭했을 때 토글버튼
      bottomBox.classList.toggle("active");
      //클래스에 이름을 추가하고 삭제하는 방법의 toggle로 작업
    }
  }
  comparisonBtn.addEventListener("click", comparison);

  //비교하기 버튼 기능
  let comparisonWrap = [];
  let selectedProducts = [];

  const comparisonSubBtn = document.querySelectorAll(".icon_text");
  const comparisonItemBox = document.querySelectorAll(
    ".compare_item_area .item_box"
  );
  const itemCount = document.querySelector(".compare_count");

  comparisonSubBtn.forEach(function (btn, index) {
    btn.addEventListener("click", function () {
      //ejs에 미리 map으로 데이터를 버튼에 저장한 data-set을 이용해 변수에 저장함
      const productName = btn.dataset.name;
      const productModel = btn.dataset.model;
      const productColor = btn.dataset.color;
      const productPrice = btn.dataset.price;
      const productImg = btn.dataset.img;
      // console.log(productModel, productName, productImg);

      const product = {
        name: productName,
        model: productModel,
        color: productColor,
        price: productPrice,
        img: productImg,
      };

      //변수로 저장한 데이터를
      const itemBoxHTML = `<div class="width-box">
                              <div class="item_img">
                                <img src="${productImg}" alt="" />
                              </div>
                              <div class="item_info">
                                <div class="item_name">${productName}</div>
                                <div class="item_model">${productModel}</div>
                                <div class="close_compare_box">
                                  <img src="/img/list/icon_compare_box_close.svg" alt="close">
                                </div>
                              </div>
                            </div>`;

      //중복제거
      const isDuplicate = comparisonWrap.includes(itemBoxHTML);
      // comparisonWrap 배열에 itemBoxHTML이 있는지 체크
      if (!isDuplicate) {
        //isDuplicate 변수가 중복되지 않은 경우
        comparisonWrap.push(itemBoxHTML);
        selectedProducts.push(product);
        console.log(selectedProducts);
        //comparisonWrap배열에 itemBoxHTMl추가
        if (comparisonWrap.length < 4) {
          itemCount.textContent++;
          // itemCount 값을 1 증가시킴
        }
      }

      //item_box안에 하나씩 itemBoxHTML를 추가하는 작업
      comparisonItemBox.forEach(function (itemBox, index) {
        //comparisonItemBox의 div와 index 값을 받아온다.
        // console.log(itemBox); //".compare_item_area .item_box"를 뜻함
        // console.log(index);//itemBox의 요소 0,1,2
        if (index < comparisonWrap.length) {
          //comparisonWrap 배열의 길이가 comparisonItemBox 요소의 개수보다 크다면 즉 일치한다면
          itemBox.innerHTML = comparisonWrap[index];
          //itemBox 안에 html을 comparisonWrap 요소를 담아줌
        } else {
          itemBox.innerText = "선택된 상품이 없습니다.";
        }
      });

      // 삭제기능
      const comparisonClose = document.querySelectorAll(".close_compare_box");

      comparisonClose.forEach(function (closeBtn, index) {
        //comparisonClose 반복되고 있는 요소의 인덱스를 매게변수로 받아옴
        closeBtn.addEventListener("click", function (e) {
          comparisonWrap.splice(index, 1);
          selectedProducts.splice(index, 1);
          //comparisonWrap와 comparisonClose가 동일한 인덱스를 가지면 삭제
          comparisonItemBox[index].innerHTML = "선택된 상품이 없습니다.";
          // comparisonItemBox의 배열의 Index와 comparisonClose 같은경우 내용 변경
          if (itemCount.textContent > 1) {
            // 1보다 큰 경우에는 1을 감소
            itemCount.textContent--;
            //클릭 될 때 마다 itemCount 숫자 감소
          } else {
            itemCount.textContent = "0";
            // 1 이하인 경우에는 0으로, 항상 0으로 유지
          }
        });
      });

      // comparisonWrap안에 3개만 담기
      if (comparisonWrap.length > 3) {
        comparisonWrap.shift(); // 가장 처음에 추가한 상품 삭제
        selectedProducts.shift();
      }
    });
  });

  const colorBtns = document.querySelectorAll(".color_chip_icon");
  const productItems = document.querySelectorAll(".product_item");

  // 컬러 필터 기능
  colorBtns.forEach(function (colorBtn) {
    colorBtn.addEventListener("click", function (e) {
      const clickedColor = e.target.dataset.colorname;
      console.log(clickedColor);
      //colorBtns의 dataset.colorname속성을 clickedColor 변수에 저장
      productItems.forEach(function (item) {
        const itemColor = item.dataset.color;
        console.log(itemColor);
        if (itemColor === clickedColor) {
          //컬러버튼을 클릭했을때 컬러랑 item컬러랑 일치할경우
          item.style.display = "inline-block";
        } else {
          item.style.display = "none";
        }
      });
    });
  });

  //사이즈 필터기능
  const imgBtns = document.querySelectorAll(".graph_link");
  const imgs = document.querySelectorAll(".graph_img");

  imgBtns.forEach(function (imgBtn) {
    imgBtn.addEventListener("click", function (e) {
      const clickedLink = e.target.parentNode.parentNode.dataset.name;
      console.log(clickedLink);

      productItems.forEach(function (item) {
        const itemImg = item.dataset.name;
        if (clickedLink === itemImg) {
          item.style.display = "inline-block";
        } else {
          item.style.display = "none";
        }
      });
    });
  });

  //쿼리작업
  const productCompareBtn = document.querySelector(".compare_btn"); //비교하기버튼

  productCompareBtn.addEventListener("click", () => {
    const query = selectedProducts.map((product, index) => {
        let item = "";
        if (index === 0) {
          item = "?product";
        } else {
          item = "&product";
        }
        return `${item}${index}=${product.model}`;
        //?product0=FAB28RCR5&product1=FAB10RCR5
      }).join("")
    console.log(query);
    location.href = "/products/compare/" + query;
  });
</script>
